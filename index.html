<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bastior Crusade – Galaxy War Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta
    name="description"
    content="Warhammer 40k Crusade galaxy map for the Bastior Sub-Sector."
  />
  <link rel="stylesheet" href="styles.css" />

  <!-- Three.js ONLY -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
  <script src="script.js" defer></script>
</head>
<body>
  <div class="app-shell">
    <!-- HEADER -->
    <header class="app-header">
      <div class="brand">
        <div class="brand-mark">BW</div>
        <div class="brand-text">
          <h1>Bastior War Council</h1>
          <p>Crusade Sector Command Console</p>
        </div>
      </div>

      <div class="header-center">
        <div class="turn-box">
          <span class="turn-label">Campaign Turn</span>
          <strong id="turnLabel">1</strong>
        </div>
      </div>

      <div class="header-actions">
        <button class="btn btn-small" id="advanceTurnBtn">Advance Turn</button>
        <button class="btn btn-small btn-ghost" id="resetStateBtn">
          Reset Map
        </button>
      </div>
    </header>

    <!-- MAIN -->
    <main class="app-main">
      <!-- MAP PANEL -->
      <section class="map-panel">
        <div class="map-toolbar">
          <div class="legend">
            <span class="legend-item">
              <span class="legend-dot defenders"></span> Defenders
            </span>
            <span class="legend-item">
              <span class="legend-dot attackers"></span> Attackers
            </span>
            <span class="legend-item">
              <span class="legend-dot raiders"></span> Raiders
            </span>
            <span class="legend-item">
              <span class="legend-dot unclaimed"></span> Unclaimed
            </span>
          </div>

          <div class="map-toolbar-right">
            <div class="zoom-controls">
              <button class="btn btn-small" id="zoomOutBtn">−</button>
              <span class="zoom-label" id="zoomLabel">100%</span>
              <button class="btn btn-small" id="zoomInBtn">+</button>
            </div>
          </div>
        </div>

        <div class="map-viewport" id="mapViewport">
          <canvas id="galaxyCanvas"></canvas>
        </div>
      </section>

      <!-- SIDEBAR -->
      <aside class="sidebar">
        <!-- Territory inspector -->
        <section class="sidebar-section selection-panel">
          <h2>Territory</h2>

          <div id="noSelectionState" class="empty-state">
            Click a world in the map to inspect and run battles for it.
          </div>

          <div id="selectionState" class="selection-body hidden">
            <h3 id="territoryName">World Name</h3>
            <div class="territory-meta" id="territoryMeta">
              Bastior Sub-Sector &middot; Node
            </div>

            <div class="field-group">
              <label for="factionSelect">Controlling Faction</label>
              <select id="factionSelect">
                <option value="defenders">Defenders</option>
                <option value="attackers">Attackers</option>
                <option value="raiders">Raiders</option>
                <option value="unclaimed">Unclaimed</option>
              </select>
            </div>

            <div class="field-group">
              <label>Control Level</label>
              <div class="control-row">
                <div class="control-display">
                  <span>Control</span>
                  <span id="controlPercent">0%</span>
                </div>
                <button class="btn btn-small" data-control="0">0</button>
                <button class="btn btn-small" data-control="25">25</button>
                <button class="btn btn-small" data-control="75">75</button>
                <button class="btn btn-small" data-control="100">100</button>
              </div>
              <p class="help-text">
                0 → 25 → 75 → 100 represent foothold, partial control, strong hold, and total dominance.
              </p>
            </div>

            <div class="field-group">
              <label>
                <input type="checkbox" id="safeToggle" />
                Mark as "Safe" after decisive defense
              </label>
              <p class="help-text">
                Safe worlds cannot be targeted for one campaign turn.
              </p>
            </div>

            <div class="battle-section">
              <h4>Resolve Battle</h4>

              <div class="battle-row">
                <div class="battle-column">
                  <span class="battle-label">Defender Faction</span>
                  <select id="defenderFactionSelect">
                    <option value="defenders">Defenders</option>
                    <option value="attackers">Attackers</option>
                    <option value="raiders">Raiders</option>
                  </select>
                </div>
                <div class="battle-column">
                  <span class="battle-label">Attacker Faction</span>
                  <select id="attackerFactionSelect">
                    <option value="attackers">Attackers</option>
                    <option value="defenders">Defenders</option>
                    <option value="raiders">Raiders</option>
                  </select>
                </div>
              </div>

              <div class="battle-buttons">
                <button class="btn btn-small" id="defenderWinBtn">
                  Defender Win
                </button>
                <button class="btn btn-small" id="attackerWinBtn">
                  Attacker Win
                </button>
              </div>

              <p class="help-text">
                Wins shift control toward the victor. If the opposing faction held the world, a decisive victory can flip it.
              </p>
            </div>
          </div>
        </section>

        <!-- Factions overview -->
        <section class="sidebar-section">
          <h2>Sector Balance</h2>
          <div class="faction-overview">
            <div class="faction-card" data-faction-summary="defenders">
              <div class="faction-card-header">
                <div class="faction-name">
                  <span class="faction-dot defenders"></span>
                  <span>Defenders</span>
                </div>
                <span class="faction-score" id="defendersSummary">
                  0 worlds · 0% influence
                </span>
              </div>
              <div class="faction-progress-bar">
                <div class="faction-progress-fill" id="defendersProgress"></div>
              </div>
            </div>

            <div class="faction-card" data-faction-summary="attackers">
              <div class="faction-card-header">
                <div class="faction-name">
                  <span class="faction-dot attackers"></span>
                  <span>Attackers</span>
                </div>
                <span class="faction-score" id="attackersSummary">
                  0 worlds · 0% influence
                </span>
              </div>
              <div class="faction-progress-bar">
                <div class="faction-progress-fill" id="attackersProgress"></div>
              </div>
            </div>

            <div class="faction-card" data-faction-summary="raiders">
              <div class="faction-card-header">
                <div class="faction-name">
                  <span class="faction-dot raiders"></span>
                  <span>Raiders</span>
                </div>
                <span class="faction-score" id="raidersSummary">
                  0 worlds · 0% influence
                </span>
              </div>
              <div class="faction-progress-bar">
                <div class="faction-progress-fill" id="raidersProgress"></div>
              </div>
            </div>

            <div class="faction-card" data-faction-summary="unclaimed">
              <div class="faction-card-header">
                <div class="faction-name">
                  <span class="faction-dot unclaimed"></span>
                  <span>Unclaimed</span>
                </div>
                <span class="faction-score" id="unclaimedSummary">
                  0 worlds
                </span>
              </div>
            </div>
          </div>
        </section>

        <!-- Log -->
        <section class="sidebar-section log-section">
          <h2>Campaign Log</h2>
          <div class="log-container">
            <ul id="logList"></ul>
          </div>
        </section>
      </aside>
    </main>
  </div>
</body>
</html>
